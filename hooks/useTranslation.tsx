import React, { createContext, useContext, useState, ReactNode } from 'react';

type Translations = {
  [key: string]: string | ((...args: any[]) => string);
};

const translations: { [lang: string]: Translations } = {
  pt: {
    'login.title': 'Controle de Acesso',
    'login.passwordLabel': 'Senha de Administrador',
    'login.passwordPlaceholder': 'Digite sua senha',
    'login.button': 'Entrar',
    'login.errors.invalidPassword': 'Senha incorreta.',
    'header.subtitle': 'Gerenciador de Credenciamento',
    'events.title': 'Selecione o Evento',
    'events.createButton': 'Criar Novo Evento',
    'events.noEvents': 'Nenhum evento encontrado.',
    'events.noEventsSubtitle': 'Crie um novo evento para começar a gerenciar os participantes.',
    'events.deleteConfirm': (name: string) => `Tem certeza que deseja deletar o evento "${name}"? Esta ação não pode ser desfeita.`,
    'events.modal.createTitle': 'Criar Novo Evento',
    'events.modal.editTitle': 'Editar Evento',
    'events.modal.nameLabel': 'Nome do Evento',
    'events.modal.namePlaceholder': 'Ex: Conferência Anual 2024',
    'events.modal.createButton': 'Criar Evento',
    'events.modal.saveButton': 'Salvar Alterações',
    'events.modal.error': 'O nome do evento não pode ser vazio.',
    'admin.backButton': 'Voltar para Eventos',
    'admin.tabs.checkin': 'Check-in',
    'admin.tabs.register': 'Registrar',
    'admin.tabs.suppliers': 'Fornecedores',
    'admin.tabs.sectors': 'Setores',
    'admin.tabs.wristbands': 'Relatório de Pulseiras',
    'admin.tabs.companies': 'Empresas',
    'checkin.searchPlaceholder': 'Buscar por nome, CPF, pulseira...',
    'checkin.stats.checkedIn': 'Check-ins',
    'checkin.stats.pending': 'Pendentes',
    'checkin.stats.total': 'Total',
    'checkin.filter.allStatuses': 'Todos os Status',
    'checkin.filter.allSuppliers': 'Todos os Fornecedores',
    'checkin.search.noResultsForTerm': (term: string) => `Nenhum resultado encontrado para "${term}"`,
    'checkin.search.noResultsForFilter': 'Nenhum participante encontrado com os filtros atuais.',
    'status.pending': 'Pendente',
    'status.checked_in': 'Checked-in',
    'status.cancelled': 'Cancelado',
    'status.substitution': 'Substituição',
    'status.substitution_request': 'Aguardando Alteração',
    'status.sector_change_request': 'Aguardando Troca de Setor',
    'status.missed': 'Ausente',
    'attendeeCard.supplierLabel': 'Fornecedor',
    'attendeeCard.wristbandNumber': 'Pulseira',
    'attendeeDetail.title': 'Detalhes do Participante',
    'attendeeDetail.formError': 'Nome, CPF e ao menos um setor são obrigatórios.',
    'attendeeDetail.deleteConfirm': (name: string) => `Tem certeza que deseja remover "${name}"?`,
    'attendeeDetail.wristbandsDuplicateError': (numbers: string) => `Os números de pulseira a seguir já estão em uso: ${numbers}.`,
    'attendeeDetail.updateWristbandButton': 'Atualizar',
    'attendeeDetail.wristbandUpdateSuccess': 'Pulseiras atualizadas!',
    'attendeeDetail.cancelButton': 'Cancelar',
    'attendeeDetail.saveButton': 'Salvar',
    'attendeeDetail.deleteButton': 'Excluir Registro',
    'attendeeDetail.wristbandLabel': 'Nº Pulseira',
    'attendeeDetail.wristbandPlaceholder': 'Digite o número',
    'attendeeDetail.substitutionRequestTitle': 'Solicitação de Alteração Pendente',
    'attendeeDetail.originalData': 'Dados Originais',
    'attendeeDetail.newData': 'Novos Dados',
    'attendeeDetail.approveButton': 'Aprovar Alteração',
    'attendeeDetail.rejectButton': 'Rejeitar Alteração',
    'attendeeDetail.sectorChangeRequestTitle': 'Solicitação de Troca de Setor Pendente',
    'attendeeDetail.currentSector': 'Setor Atual',
    'attendeeDetail.requestedSector': 'Setor Solicitado',
    'attendeeDetail.justification': 'Justificativa',
    'attendeeDetail.approveSectorChangeButton': 'Aprovar Troca de Setor',
    'attendeeDetail.rejectSectorChangeButton': 'Rejeitar Troca',
    'statusUpdateModal.currentStatus': 'Status Atual',
    'statusUpdateModal.confirmCheckin': 'Confirmar Check-in',
    'statusUpdateModal.cancelCheckin': 'Cancelar Check-in',
    'statusUpdateModal.reactivateRegistration': 'Reativar Cadastro',
    'statusUpdateModal.markAsMissed': 'Marcar como Ausente',
    'statusUpdateModal.allowSubstitution': 'Permitir Substituição',
    'statusUpdateModal.cancelRegistration': 'Cancelar Inscrição',
    'statusUpdateModal.closeButton': 'Fechar',
    'register.title': 'Registro de Participante',
    'register.checkingCpf': 'Verificando CPF...',
    'register.cpfFound': 'CPF já cadastrado. Dados carregados.',
    'register.cpfNotFound': 'CPF não encontrado. Prossiga com o novo cadastro.',
    'register.cpfAlreadyRegistered': 'Este CPF já foi credenciado para este evento. Não é possível registrar novamente.',
    'register.photoLocked': 'A foto está travada pois o participante já possui cadastro.',
    'register.successMessage': 'Participante registrado com sucesso!',
    'register.form.cpfLabel': 'CPF',
    'register.form.cpfPlaceholder': '000.000.000-00',
    'register.form.nameLabel': 'Nome Completo',
    'register.form.namePlaceholder': 'Digite o nome do participante',
    'register.form.sectorLabel': 'Setor',
    'register.form.sectorPlaceholder': 'Selecione um setor',
    'register.form.supplierLabel': 'Fornecedor (Opcional)',
    'register.form.supplierPlaceholder': 'Nenhum / Manual',
    'register.form.subCompanyLabel': 'Empresa / Unidade',
    'register.form.subCompanyLabelOptional': 'Empresa / Unidade (Opcional)',
    'register.form.subCompanyPlaceholder': 'Selecione a empresa/unidade',
    'register.form.subCompanyInputPlaceholder': 'Digite o nome da empresa/unidade',
    'register.form.button': 'Registrar Participante',
    'register.errors.allFields': 'Todos os campos são obrigatórios: nome, CPF, foto e setor.',
    'register.errors.invalidCpf': 'O CPF informado é inválido.',
    'register.errors.subCompanyRequired': 'É obrigatório selecionar uma empresa/unidade.',
    'register.errors.cpfCheckError': 'Erro ao verificar o CPF.',
    'register.errors.cpfCheckIndexError': 'Erro de banco de dados ao consultar CPF. Verifique os índices do Firestore.',
    'webcam.starting': 'Iniciando câmera...',
    'webcam.retakeButton': 'Tirar Outra Foto',
    'webcam.captureButton': 'Capturar Foto',
    'webcam.uploadButton': 'Enviar Arquivo',
    'verificationModal.title': 'Verificação Facial para',
    'verificationModal.registeredPhoto': 'Foto do Cadastro',
    'verificationModal.liveVerification': 'Verificação ao Vivo',
    'verificationModal.confirmButton': 'Confirmar Check-in Manual',
    'suppliers.generateTitle': 'Gerenciar Links de Fornecedores',
    'suppliers.nameLabel': 'Nome do Fornecedor',
    'suppliers.namePlaceholder': 'Ex: Empresa de Limpeza',
    'suppliers.limitLabel': 'Limite de Cadastros',
    'suppliers.limitPlaceholder': 'Nº máximo de pessoas',
    'suppliers.sectorsLabel': 'Setores Permitidos',
    'suppliers.subCompaniesLabel': 'Sub-empresas / Unidades (Opcional)',
    'suppliers.subCompaniesPlaceholder': 'Nome da empresa/unidade',
    'suppliers.subCompanySectorPlaceholder': 'Setor da Sub-empresa',
    'suppliers.addSubCompanyButton': 'Adicionar',
    'suppliers.generateButton': 'Gerar Link',
    'suppliers.existingLinks': 'Links Existentes',
    'suppliers.noNameError': 'O nome do fornecedor é obrigatório.',
    'suppliers.noSectorsError': 'Selecione ao menos um setor.',
    'suppliers.noLimitError': 'O limite de cadastros deve ser um número maior que zero.',
    'suppliers.deleteConfirm': (name: string) => `Tem certeza que deseja deletar o fornecedor "${name}"? O link se tornará inválido.`,
    'suppliers.deleteErrorInUse': (name: string) => `O fornecedor "${name}" não pode ser excluído pois já possui participantes cadastrados.`,
    'suppliers.active': 'Ativo',
    'suppliers.inactive': 'Inativo',
    'suppliers.registrations': 'Cadastros',
    'suppliers.copiedButton': 'Copiado!',
    'suppliers.copyButton': 'Copiar Link',
    'suppliers.adminLink.copyTooltip': 'Copiar link de visualização (somente leitura)',
    'suppliers.adminLink.regenerateTooltip': 'Gerar novo link de visualização (invalida o antigo)',
    'suppliers.disableButton': 'Desativar',
    'suppliers.enableButton': 'Ativar',
    'suppliers.editButton': 'Editar',
    'suppliers.deleteButton': 'Excluir',
    'suppliers.cancelButton': 'Cancelar',
    'suppliers.saveButton': 'Salvar',
    'suppliers.noLinks': 'Nenhum link de fornecedor gerado ainda.',
    'supplierRegistration.closedTitle': 'Inscrições Encerradas',
    'supplierRegistration.closedMessage': 'O período de inscrições através deste link foi encerrado ou o link é inválido.',
    'supplierAdmin.title': 'Visualização de Credenciados',
    'supplierAdmin.supplier': 'Fornecedor:',
    'supplierAdmin.noAttendees': 'Nenhum participante credenciado por este fornecedor ainda.',
    'supplierAdmin.requestEdit': 'Editar',
    'supplierAdmin.editRequested': 'Edição Solicitada',
    'supplierAdmin.filter.searchPlaceholder': 'Buscar por nome...',
    'supplierAdmin.filter.allCompanies': 'Todas as Empresas',
    'editModal.title': 'Solicitar Edição para',
    'editModal.newData': 'Novos Dados',
    'editModal.submitButton': 'Enviar Solicitação de Edição',
    'sectors.title': 'Gerenciar Setores',
    'sectors.noSectors': 'Nenhum setor cadastrado.',
    'sectors.noSectorsSubtitle': 'Crie setores para organizar seus participantes.',
    'sectors.createButton': 'Criar Novo Setor',
    'sectors.deleteConfirm': (label: string) => `Tem certeza que deseja deletar o setor "${label}"?`,
    'sectors.deleteErrorInUse': (label: string) => `O setor "${label}" não pode ser excluído pois está em uso por fornecedores ou participantes.`,
    'sectors.modal.createTitle': 'Criar Novo Setor',
    'sectors.modal.editTitle': 'Editar Setor',
    'sectors.modal.labelLabel': 'Nome do Setor',
    'sectors.modal.labelPlaceholder': 'Ex: Staff, Imprensa, Apoio',
    'sectors.modal.colorLabel': 'Cor de Identificação',
    'sectors.modal.error': 'O nome do setor não pode ser vazio.',
    'sectors.modal.saveButton': 'Salvar',
    'wristbandReport.title': 'Relatório de Pulseiras Entregues',
    'wristbandReport.stats.deliveredOf': (delivered: number, total: number) => `${delivered} de ${total} entregues`,
    'wristbandReport.searchPlaceholder': 'Buscar por nome, CPF ou nº da pulseira',
    'wristbandReport.filter.allSectors': 'Todos os Setores',
    'wristbandReport.list.header.name': 'Nome',
    'wristbandReport.list.header.wristband': 'Nº Pulseira',
    'wristbandReport.list.header.sector': 'Setor',
    'wristbandReport.list.header.color': 'Cor',
    'wristbandReport.noWristbands': 'Nenhuma pulseira foi entregue ainda.',
    'wristbandReport.noResults': 'Nenhum resultado encontrado.',
    'spreadsheet.title': 'Importar em Lote',
    'spreadsheet.description': 'Faça o upload de um arquivo CSV para registrar múltiplos participantes de uma vez.',
    'spreadsheet.requiredColumns': 'Colunas obrigatórias: <strong>name, cpf, sector</strong>.',
    'spreadsheet.optionalColumns': 'Colunas opcionais: <strong>fornecedor, empresa</strong>.',
    'spreadsheet.button.choose': 'Escolher Arquivo CSV',
    'spreadsheet.button.processing': 'Processando...',
    'spreadsheet.button.downloadTemplate': 'Baixar modelo da planilha',
    'spreadsheet.importSuccess': (count: number) => `${count} participantes importados com sucesso!`,
    'spreadsheet.error.emptyFile': 'O arquivo CSV está vazio ou em um formato incorreto.',
    'spreadsheet.error.readFile': (message: string) => `Erro ao ler o arquivo: ${message}`,
    'import.errors.requiredColumns': 'Colunas obrigatórias (name, cpf, sector) faltando.',
    'errors.loadEvents': 'Falha ao carregar eventos.',
    'errors.saveEvent': 'Falha ao salvar evento.',
    'errors.deleteEvent': 'Falha ao deletar evento.',
    'errors.subscriptionError': 'Erro ao sincronizar dados do evento.',
    'errors.invalidSupplierLink': 'Link de fornecedor inválido ou o evento não foi encontrado.',
    'errors.registrationLimitReached': 'O limite de cadastros para este fornecedor foi atingido.',
    'companies.title': 'Gerenciar Empresas',
    'companies.attendeeCount': (count: number) => `${count} participante(s)`,
    'companies.noCompanies': 'Nenhuma empresa/unidade encontrada.',
    'companies.noCompaniesSubtitle': 'Cadastre participantes com uma empresa para gerenciá-los aqui.',
    'companies.modal.bulkUpdateTitle': (count: number) => `Editar Setores para ${count} Colaborador(es)`,
    'companies.modal.bulkUpdateDescription': 'Esta ação substituirá os setores atuais dos colaboradores selecionados.',
    'companies.modal.saveButton': 'Salvar Alterações',
    'companies.editSelectedButton': 'Editar Setores',
    'companies.selectAll': 'Selecionar Todos',
    'companies.selectedCount': (count: number) => `${count} selecionado(s)`,
  },
};

interface LanguageContextType {
  language: string;
  setLanguage: (language: string) => void;
  t: (key: string, ...args: any[]) => string;
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<string>('pt');

  const t = (key: string, ...args: any[]): string => {
    const translation = translations[language]?.[key];
    if (typeof translation === 'function') {
      return translation(...args);
    }
    if (typeof translation === 'string') {
        return translation;
    }
    return key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = (): LanguageContextType => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};